<?php
include_once "control/rig.class.php";
?><!doctype html>
<html lang="en">
  <head>
     <title>Aries Cloud</title><?php
	include_once "model/headerlinks.php";
  ?><script language="javascript">
		function frmSubmit(objFrm) {
			if(objFrm.txtName.value=="") {
				document.getElementById('rig').style.display="block";
				objFrm.txtName.focus();
				return false;
			}
			else {
				document.getElementById('rig').style.display="none";
			}

			if(objFrm.txtClientName.value=="") {
				document.getElementById('client').style.display="block";
				objFrm.txtClientName.select();
				return false;
			}
			else {
				document.getElementById('client').style.display="none";
			}

			if(objFrm.txtIMO.value=="") {
				document.getElementById('imo').style.display="block";
				objFrm.txtIMO.focus();
				return false;
			}
			else {
				document.getElementById('imo').style.display="none";
			}

			if(objFrm.txtRigmanager.value=="") {
				document.getElementById('rig_manager').style.display="block";
				objFrm.txtRigmanager.focus();
				return false;
			}
			else {
				document.getElementById('rig_manager').style.display="none";
			}

			if(objFrm.txtRigtype.value=="") {
				document.getElementById('rig_type').style.display="block";
				objFrm.txtRigtype.focus();
				return false;
			}
			else {
				document.getElementById('rig_type').style.display="none";
			}

			if(objFrm.txtClassification.value=="") {
				document.getElementById('classification').style.display="block";
				objFrm.txtClassification.focus();
				return false;
			}
			else {
				document.getElementById('classification').style.display="none";
			}

			
			if(objFrm.txtUserName.value=="") {
				document.getElementById('user_name').style.display="block";
				objFrm.txtUserName.focus();
				return false;
			}
			else {
				document.getElementById('user_name').style.display="none";
			}

			if(objFrm.txtPassword.value=="") {
				document.getElementById('password').style.display="block";
				objFrm.txtPassword.focus();
				return false;
			}
			else {
				document.getElementById('password').style.display="none";
			}

			if(objFrm.txtRPassword.value=="") {
				document.getElementById('rpassword').style.display="block";
				objFrm.txtRPassword.focus();
				return false;
			}
			else {
				document.getElementById('rpassword').style.display="none";
			}

			if(objFrm.txtRemarks.value=="") {
				document.getElementById('remarks').style.display="block";
				objFrm.txtRemarks.focus();
				return false;
			}
			else {
				document.getElementById('remarks').style.display="none";
			}
		}
		/*Function for deleting records*/
		function deleteRec(path,id,page) {
			if(confirm('Are you sure to delete this record')) {
				location.href= path+"?doAction=DELETE_RIG&rig_id="+id+"&page="+page;
			}
		}
		/*Function for submitting Password*/
		function frmPassSubmit(objFrm) {
			if(objFrm.txtUserName.value=="") {
				document.getElementById('user_name').style.display="block";
				objFrm.txtUserName.focus();
				return false;
			}
			else {
				document.getElementById('user_name').style.display="none";
			}
			if(objFrm.txtPassword.value=="") {
				document.getElementById('password').style.display="block";
				objFrm.txtPassword.focus();
				return false;
			}
			else {
				document.getElementById('password').style.display="none";
			}

			if(objFrm.txtRPassword.value=="") {
				document.getElementById('rpassword').style.display="block";
				objFrm.txtRPassword.focus();
				return false;
			}
			else {
				document.getElementById('rpassword').style.display="none";
			}
		}
  </script>
  </head>
   <body>
		<div class="main"><!-- topbar start --><?php
			include_once "model/topbar.php";
			?><!-- topbar end -->
			<!-- navigation bar start--><?php
			include_once "model/navigation.php";
			?><!-- navigation bar end-->
				<!-- left bar start --><?php
			include_once "model/leftbar.php";
			?><div class="clear">
				</div>
				<!-- left bar end -->
				<!-- Content start -->
				<div class="content"><?
					switch($rig->doAction) {
						case"":
							$reslt = $rig->getRigInfo();
								$r_rec = 	$rig->objCommonFunc->executeQuery("SELECT FOUND_ROWS() no");
							$row_rec = mysqli_fetch_assoc($r_rec);
							$total_rec = $row_rec['no'];
							?><div class="subcontent">
								<span class="heading1"><strong>RIG MANAGEMENT</strong></span>
								<div class="search"><?php
								if(!empty($rig->errMsg)) {
								?><div id="errMsg"><?php print($rig->errMsg)?></div><?php
								}
								?>
								<table width='100%'>
									<tr>
										<td>
											<div class="div_left">
												<form method="post" action="<?php print(FILENAME)?>">
												<input type="text" name="txtFilterName" value="<?php print($rig->txtFilterName)?>" class="txtfield" size="30"/>
												<input type="submit" value="SEARCH" class="button1"/>
												<a href="<?php print(FILENAME)?>?doAction=CLEAR" class="button1">CLEAR</a>
												</form>
											</div>
										</td>
										<td align='right'>
											
												<form method="post" action="<?php print(FILENAME)?>">
												<input type="hidden" name="doAction" value="ADD"/>
												<span style="float:right;"><input type="submit" value="ADD" class="button1"/></span>
												</form>
										</td>
									</tr>
									</table>
								</div>
								
								<table class="mainTable" cellpadding="0" cellspacing="0">
									<th width="20%" >Rig Name</th><th width="25%">Client</th><th width="25%">IMO</th><th width="10%">Username</th><th width="2%" colspan="3">Action</th><?php
								while($row = $rig->objCommonFunc->fetchAssoc($reslt)) {
									?><tr><td><?php print($row['rig_name'])?></td>
									<td><?php print($row['client_name'])?></td>
									<td><?php print($row['rig_imo_no'])?></td>
									<td><?php print($row['rl_username'])?></td>
									<td align="center"><a href="<?php print(FILENAME)?>?rig_id=<?php print($row['rig_id'])?>&doAction=EDIT"><img src="images/edit.jpeg" height="16" width="25" title="Edit"></i></a></td>
									<td align="center"><?php
										//if($_SESSION['type'] == 'S') {
										?><a href="<?php print(FILENAME)?>?rig_id=<?php print($row['rig_id'])?>&doAction=CHANGEPASSWORD"><img src="images/password.png" height="16" width="25" title="Change Password"></i></a><?php 
										//}
										?></td>
									<td align="center"><a href="javascript:deleteRec('<?php print(FILENAME)?>','<?php print($row['rig_id'])?>','<?php print($rig->page)?>')"><img src="images/delete.png" height="16" width="25" title="Delete"></i></a></td></tr><?php
								}
								?></table><?php
									$rig->objPagination->showPagination($total_rec,FILENAME,$rig->params);
							?></div><?php
							break;
						case"ADD":
						case"EDIT":
							if(isset($_REQUEST['rig_id'])){
								$arrInfo = $rig->roGgetRigInfo();
								$_REQUEST['txtName'] = $arrInfo['rig_name'];
								$_REQUEST['txtClientName'] = $arrInfo['rig_client_id'];
								$_REQUEST['txtIMO'] = $arrInfo['rig_imo_no'];
								$_REQUEST['txtRigmanager'] = $arrInfo['rig_manager'];
								$_REQUEST['txtRigtype'] = $arrInfo['rig_type'];
								$_REQUEST['txtClassification'] = $arrInfo['rig_classification'];
								$_REQUEST['txtPassword'] = $arrInfo['rig_client_id'];
								$_REQUEST['txtRPassword'] = $arrInfo['rig_client_id'];
								$_REQUEST['txtRemarks'] = $arrInfo['rig_remarks'];
								$_REQUEST['txtUserName'] = $arrInfo['rl_username'];
								$heading = "RIG MANAGEMENT- Edit Rig ";
							}
							else {
								$heading = "RIG MANAGEMENT- Add Rig";
							}
							if(empty($_REQUEST['txtName'])) {
								$_REQUEST['txtName'] = "";
							}
							if(empty($_REQUEST['txtClientName'])) {
								$_REQUEST['txtClientName'] = "";
							}
							if(empty($_REQUEST['txtIMO'])) {
								$_REQUEST['txtIMO'] = "";
							}
							if(empty($_REQUEST['txtRigmanager'])) {
								$_REQUEST['txtRigmanager'] = "";
							}
							if(empty($_REQUEST['txtRigtype'])) {
								$_REQUEST['txtRigtype'] = "";
							}
							if(empty($_REQUEST['txtClassification'])) {
								$_REQUEST['txtClassification'] = "";
							}
							if(empty($_REQUEST['txtPassword'])) {
								$_REQUEST['txtPassword'] = "";
							}
							if(empty($_REQUEST['txtRPassword'])) {
								$_REQUEST['txtRPassword'] = "";
							}
							if(empty($_REQUEST['txtRemarks'])) {
								$_REQUEST['txtRemarks'] = "";
							}
							if(empty($_REQUEST['txtUserName'])) {
								$_REQUEST['txtUserName'] = "";
							}
							$rsl1 = $rig->getClientNameList();
							?><div class="subcontent">
								<div class="search">
								<span class="heading1"><strong><?php print($heading)?></strong></span><?php
								if(!empty($adminuser->errMsg)) {
								?><br/><span style='color:red;text-align:center;width:100%;border:1px solid;'><strong><?php print($adminuser->errMsg)?></strong></span><?php
								}
								?>
								</div>
								<div class="frm-content">
									<form method="post" action="<?php print(FILENAME)?>" onsubmit="return frmSubmit(this)">
										<table border="0" align="center" >
											<tr>
												<td>Rig Name<strong class="astric">*</strong></td><td><input type="text" name="txtName" value="<?php print(htmlentities($_REQUEST['txtName'],ENT_QUOTES))?>" class="txtfield" size="30"/>
												<div class="arrow_box" id='rig' style="display:none;">Please enter Rig name</div>
												</td>
											</tr>
											<tr>
												<td>Client Name<strong class="astric">*</strong></td><td><select name="txtClientName" id="txtClientName"  class="txtfield"><option value=""></option><?php
													while($row = $rig->objCommonFunc->fetchAssoc($rsl1)) {
														?><option value="<?php print($row['client_id'])?>" <?php if($_REQUEST['txtClientName'] == $row['client_id']) {  print("selected");}?>><?php print($row['client_name'])?></option><?php
													}
												?></select>
												
												
												<div class="arrow_box" id='client' style="display:none;">Please enter Cleint Name</div>
												</td>
											</tr>
											<tr>
												<td>IMO Number<strong class="astric">*</strong></td><td><input type="text" name="txtIMO" value="<?php print(htmlentities($_REQUEST['txtIMO'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtIMO"/>
												<div class="arrow_box" id='imo' style="display:none;">Please enter IMO Number</div>
												</td>
											</tr>
											<tr>
												<td>Rig Manager<strong class="astric">*</strong></td><td><input type="text" name="txtRigmanager" value="<?php print(htmlentities($_REQUEST['txtRigmanager'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtRigmanager"/>
												<div class="arrow_box" id='rig_manager' style="display:none;">Please enter Rig Manager<div>
												</td>
											</tr>
											<tr>
												<td>Rig Type<strong class="astric">*</strong></td><td><input type="text" name="txtRigtype" value="<?php print(htmlentities($_REQUEST['txtRigtype'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtRigtype"/>
												<div class="arrow_box" id='rig_type' style="display:none;">Please enter Rig Type</div>
												</td>
											</tr>
											<tr>
												<td>Classification<strong class="astric">*</strong></td><td><input type="text" name="txtClassification" value="<?php print(htmlentities($_REQUEST['txtClassification'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtClassification"/>
												<div class="arrow_box" id='classification' style="display:none;">Please enter Classification</div>
												</td>
											</tr>

											<?php
											if(empty($rig->rig_id)){
											?><tr>
												<td>User Name<strong class="astric">*</strong></td><td><input type="text" name="txtUserName" value="<?php print(htmlentities($_REQUEST['txtUserName'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtUserName"/>
												<div class="arrow_box" id='user_name' style="display:none;">Please enter User Name</div>
												</td>
											</tr>
											<tr>
												<td>Password<strong class="astric">*</strong></td><td><input type="password" name="txtPassword" value="<?php print(htmlentities($_REQUEST['txtPassword'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtPassword"/>
												<div class="arrow_box" id='password' style="display:none;">Please enter Password/<div>
												</td>
											</tr>
											<tr>
												<td>Re-type your password<strong class="astric">*</strong></td><td><input type="password" name="txtRPassword" value="<?php print(htmlentities($_REQUEST['txtRPassword'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtRPassword"/>
												<div class="arrow_box" id='rpassword' style="display:none;">Please Re-type your password</div>
												</td>
											</tr><?php
												}
											?><tr>
												<td>Remarks<strong class="astric">*</strong></td><td><textarea name="txtRemarks" class="txtfield" cols="23" rows="4" id="txtRemarks"/><?php print($_REQUEST['txtRemarks'])?></textarea>
												<div class="arrow_box" id='remarks' style="display:none;">Please enter Remarks</div>
												</td>
											</tr><?php
												
											?><tr>
												<td align="center" colspan="2"><input type="submit" value="SUBMIT" class="button1"/>&nbsp;&nbsp;<a href="<?php print(FILENAME)?>" class="button1">CANCEL</a></td>
											</tr>
										</table>
										<input type='hidden' name='page' value="<?php print($rig->page)?>"/>
										<input type='hidden' name='rig_id' value="<?php print($rig->rig_id)?>"/>
										<?php
										if(!empty($_REQUEST['rig_id'])) {
											?><input type='hidden' name='doAction' value="UPDATE_RIG"/><?php
										}
										else {
											?><input type='hidden' name='doAction' value="ADD_RIG"/><?php
										}
									?></form>
								</div>
							</div><?php
							break;
						case"CHANGEPASSWORD":
							$heading = "RIG MANAGEMENT- Change Password";
							
							if(empty($_REQUEST['txtPassword'])) {
								$_REQUEST['txtPassword'] = "";
							}
							if(empty($_REQUEST['txtRPassword'])) {
								$_REQUEST['txtRPassword'] = "";
							}
							if(isset($_REQUEST['rig_id'])){
								$arrInfo = $rig->roGgetRigInfo();
								$_REQUEST['txtUserName'] = $arrInfo['rl_username'];

							}
							$rsl1 = $rig->getClientNameList();
							?><div class="subcontent">
								<div class="search">
								<span class="heading1"><strong><?php print($heading)?></strong></span>
								</div>
								<div class="frm-content">
									<form method="post" action="<?php print(FILENAME)?>" onsubmit="return frmPassSubmit(this)">
										<table border="0" align="center" >
											<tr>
												<td>Old Password</td>
												<td><?php print($arrInfo['password'])?></td>
											</tr><?php
											if(!empty($rig->rig_id)){
											?><tr>
												<td>User Name<strong class="astric">*</strong></td><td><input type="text" name="txtUserName" value="<?php print(htmlentities($_REQUEST['txtUserName'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtUserName"/>
												<div class="arrow_box" id='user_name' style="display:none;">Please enter User Name</div>
												</td>
											</tr>
											<tr>
												<td>New Password<strong class="astric">*</strong></td><td><input type="password" name="txtPassword" value="<?php print(htmlentities($_REQUEST['txtPassword'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtPassword"/>
												<div class="arrow_box" id='password' style="display:none;">Please enter Password<div>
												</td>
											</tr>
											<tr>
												<td>Re-type your password<strong class="astric">*</strong></td><td><input type="password" name="txtRPassword" value="<?php print(htmlentities($_REQUEST['txtRPassword'],ENT_QUOTES))?>" class="txtfield" size="30" id="txtRPassword"/>
												<div class="arrow_box" id='rpassword' style="display:none;">Please Re-type your password</div>
												</td>
											</tr><?php
												}
											?><tr>
												<td align="center" colspan="2"><input type="submit" value="SUBMIT" class="button1"/><a href="<?php print(FILENAME)?>" class="button1">CANCEL</a></td>
											</tr>
										</table>
										<input type='hidden' name='page' value="<?php print($rig->page)?>"/>
										<input type='hidden' name='rig_id' value="<?php print($rig->rig_id)?>"/>
										<input type='hidden' name='doAction' value="UPDATE_PASSWORD"/>
									</form>
								</div>
							</div><?php
							break;
					}
				?></div>
				<!-- Content end -->
				<div class="clear">
				</div>
				<!-- footer start --><?php
			include_once "model/footer.php";
			?><!-- footer end -->
		</div>
   </body>
</html>