<?php
include_once "control/subcategory.class.php";
?><!doctype html>
<html lang="en">
  <head>
     <title>Aries Cloud</title><?php
	include_once "model/headerlinks.php";
  ?><script language="javascript">
		function frmSubmit(objFrm) {
			if(objFrm.txtName.value=="") {
				document.getElementById('name').style.display="block";
				return false;
			}
			else {
				document.getElementById('name').style.display="none";
			}
		}
		/*Function for deleting records*/
		function deleteRec(path,id,page) {
			if(confirm('Are you sure to delete this record')) {
				location.href= path+"?doAction=DELETE_SUBCATEGORY&cat_id="+id+"&page="+page;
			}
		}
  </script>
  </head>
   <body>
		<div class="main"><!-- topbar start --><?php
			include_once "model/topbar.php";
			?><!-- topbar end -->
			<!-- navigation bar start--><?php
			include_once "model/navigation.php";
			?><!-- navigation bar end-->
				<!-- left bar start --><?php
			include_once "model/leftbar.php";
			?><div class="clear">
				</div>
				<!-- left bar end -->
				<!-- Content start -->
				<div class="content"><?
					switch($subcategory->doAction) {
						case"":
							$reslt = $subcategory->getCategoryInfo();
						$r_rec = 	$subcategory->objCommonFunc->executeQuery("SELECT FOUND_ROWS() no");
							$row_rec = mysqli_fetch_assoc($r_rec);
							$total_rec = $row_rec['no'];
							?><div class="subcontent">
								<span class="heading1"><strong>SUBCATEGORY MANAGEMENT</strong></span>
								<div class="search"><?php
								if(!empty($_REQUEST['errMsg'])) {
								?><div id="errMsg">
										Sorry! you can't delete this subcategory . There are some reports exists under this subcategory.
								  </div><?php
								}
								?>
								<table width='100%'>
									<tr>
										<td>
											<div class="div_left">
												<form method="post" action="<?php print(FILENAME)?>">
												<input type="text" name="txtFilterName" value="<?php print($subcategory->txtFilterName)?>" class="txtfield" size="30"/>
												<input type="submit" value="SEARCH" class="button1"/>
												<a href="<?php print(FILENAME)?>?doAction=CLEAR" class="button1">CLEAR</a>
												</form>
											</div>
										</td>
										<td align='right'>
												<form method="post" action="<?php print(FILENAME)?>">
												<input type="hidden" name="doAction" value="ADD"/>
												<span style="float:right;"><input type="submit" value="ADD" class="button1"/></span>
												</form>
										</td>
									</tr>
									</table>
									
								</div>
								
								<table class="mainTable" cellpadding="0" cellspacing="0">
									<th >Subcategory Name</th>
									<th >Category Name</th><th width="25%">Edit</th><th width="25%">Delete</th><?php
								while($row = $subcategory->objCommonFunc->fetchAssoc($reslt)) {
									?><tr><td><?php print($row['subcat_name'])?></td>
									<td><?php print($row['cat_name'])?></td>
									<td align="center"><a href="<?php print(FILENAME)?>?cat_id=<?php print($row['cat_id'])?>&doAction=EDIT"><img src="images/edit.jpeg" height="16" width="25" title="Edit"></i></a></td>
									<td align="center"><a href="javascript:deleteRec('<?php print(FILENAME)?>','<?php print($row['cat_id'])?>','<?php print($subcategory->page)?>')"><img src="images/delete.png" height="16" width="25" title="Delete"></i></a></td></tr><?php
								}
								?></table><?php
									$subcategory->objPagination->showPagination($total_rec,FILENAME,$subcategory->params);
							?></div><?php
							break;
						case"ADD":
						case"EDIT":
							if(isset($_REQUEST['cat_id'])){
								$arrInfo = $subcategory->objCommonFunc->getSingleRecInfo('*',"sub_categories","subcat_id=".$_REQUEST['cat_id']."");
								$_REQUEST['txtName'] = $arrInfo['subcat_name'];
								$_REQUEST['txtCat'] =  $arrInfo['subcat_cat_id'];
								$heading = "SUBCATEGORY MANAGEMENT- Edit Category ";
							}
							else {
								$heading = "SUBCATEGORY MANAGEMENT- Add subcategory";
							}
							if(empty($_REQUEST['txtName'])) {
								$_REQUEST['txtName'] = "";
							}
							if(empty($_REQUEST['txtCat'])) {
								$_REQUEST['txtCat'] = "";
							}
							$rsl3 = $subcategory->getCategoryNameList();
							?><div class="subcontent">
								<div class="search">
								<span class="heading1"><strong><?php print($heading)?></strong></span>
								</div>
								<div class="frm-content">
									<form method="post" action="<?php print(FILENAME)?>" onsubmit="return frmSubmit(this)">
										<table border="0" align="center" >
											<tr>
												<td>Select Category<strong class="astric">*</strong></td><td>
													<select name="txtCat" id="txtCat"  class="txtfield" onchange="javascript:loadXMLDoc(this.value)"><option value="">-- Select Category-- </option><?php
													while($row = $subcategory->objCommonFunc->fetchAssoc($rsl3)) {
														?><option value="<?php print($row['cat_id'])?>" <?php if($_REQUEST['txtCat'] == $row['cat_id']) {  print("selected");}?>><?php print($row['cat_name'])?></option><?php
													}
												?></select>
												<div class="arrow_box" id='cat' style="display:none;">Please select Category</div>
												</td>
											</tr>
											<tr>
												<td>Subcategory Name<strong class="astric">*</strong></td><td><input type="text" name="txtName" value="<?php print(htmlentities($_REQUEST['txtName'],ENT_QUOTES))?>" class="txtfield" size="30"/>
												<div class="arrow_box" id='name' style="display:none;">Please enter Subcategory name<div>
												</td>
											</tr>
											<tr>
												<td align="center" colspan="2"><input type="submit" value="SUBMIT" class="button1"/>&nbsp;&nbsp;<a href="<?php print(FILENAME)?>" class="button1">CANCEL</a></td>
											</tr>
										</table>
										<input type='hidden' name='page' value="<?php print($subcategory->page)?>"/>
										<input type='hidden' name='cat_id' value="<?php print($subcategory->cat_id)?>"/>
										<?php
										if(!empty($_REQUEST['cat_id'])) {
											?><input type='hidden' name='doAction' value="UPDATE_SUBCATEGORY"/><?php
										}
										else {
											?><input type='hidden' name='doAction' value="ADD_SUBCATEGORY"/><?php
										}
									?></form>
								</div>
							</div><?php
							break;
					}
				?></div>
				<!-- Content end -->
				<div class="clear">
				</div>
				<!-- footer start --><?php
			include_once "model/footer.php";
			?><!-- footer end -->
		</div>
   </body>
</html>